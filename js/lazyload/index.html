<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body{
            background-color: gray;
        }
        img {
            display: block;
            margin-bottom: 50px;
            width: 400px;
            height: 400px;
        }
    </style>
</head>
<body>
<!--     数据属性 data-src 属性手动的触发下载 权力拿到手上来-->
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img1.360buyimg.com/da/jfs/t1/235876/12/4973/169897/65684ddcFba5ff356/1200d3127d8977cb.jpg!q70.jpg" />
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190808/v2_1565254363234_img_jpg">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190905/v2_1567641293753_img_png">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png"  data-src="https://img.36krcdn.com/20190905/v2_1567640518658_img_png">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png"  data-src="https://img.36krcdn.com/20190905/v2_1567642423719_img_000">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png"  data-src="https://img.36krcdn.com/20190905/v2_1567642425030_img_000">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190905/v2_1567642425101_img_000">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190905/v2_1567642425061_img_000">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190904/v2_1567591358070_img_jpg">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190905/v2_1567641974410_img_000">
<img src="https://misc.360buyimg.com/mtd/pc/common/img/blank.png" data-src="https://img.36krcdn.com/20190905/v2_1567641974454_img_000">
<script src="https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
<script>
    const imgs=document.getElementsByTagName('img');
    const num=imgs.length;
   // console.log(imgs);
    //注册在scrooll事件上的处理函数
    const
    window.addEventListener('scroll',throttle(lazyload,200));
    window.addEventListener('scroll',throttleLayLoad);
    let n=0;
    document.addEventListener('DOMContentLoaded',()=>{
       lazyload()
    })
    window.addEventListener('load',()=>{
        console.log('load')
    })
    //不要重复造轮子
    // function throttle(func, limit) {
    //     let inThrottle;
    //     return function() {
    //         const context = this;
    //         const args = arguments;
    //         if (!inThrottle) {
    //             func.apply(context, args);
    //             inThrottle = true;
    //             setTimeout(() => inThrottle = false, limit);
    //         }
    //     };
    // }

    // 使用示例
    const myEfficientFn = throttle(function() {
        // 需要节流处理的代码
    }, 250);

    window.addEventListener('scroll', myEfficientFn);
    function lazyload(event){
       //一屏的高度
        let screenHeight=document.documentElement.clientHeight;
        //滚动条滚动的距离 多浏览器适配
        //IE做死
        let scrollTop=document.documentElement.scrollTop||document.body.scrollTop
            //图片在不在可视区域里呢？
        console.log(scrollTop);
        for (let i=0;i<num;i++){
           if(imgs[i].offsetTop<screenHeight+scrollTop){
   //主动触发下载
               imgs[i].src=imgs[i].getAttribute('data-src');
               n=i+1//有多少图片加载
               if (n===num){
                   console.log('所有图片都加载完成')
                   window.removeEventListener('scroll',throttleLayLoad)
               }
           }
        }
    }
</script>
</body>
</html>